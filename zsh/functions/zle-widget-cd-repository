# vim: set ft=zsh:

emulate -L zsh

local rootdir candidates selected

if (( ! ${+commands[fzy]} )) return

rootdir=${HOME}/src
if [[ ! -d ${rootdir} ]] return

candidates="$(cd -q ${rootdir}; print -rl -- */*/*(N-/))"
if [[ -z ${candidates} ]] return

echoti cud1
selected="$(print -r -- ${candidates} | fzy)"
echoti cuu1
zle reset-prompt

if [[ -n ${selected} ]] {
    BUFFER="cd ${(q)rootdir}/${(q)selected}"
    zle accept-line
}
