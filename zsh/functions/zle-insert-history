# vim: set ft=zsh:

emulate -L zsh
setopt extended_glob

local selected

if (( ! ${+commands[fzy]} )) return

echoti cud1
selected="$(fc -lr 1 | fzy --query="${BUFFER}")"
echoti cuu1
zle reset-prompt

if [[ -n ${selected} ]] {
    BUFFER=${history[$((${selected[(w)1%\*]}))]}
    CURSOR=${#BUFFER}
}
